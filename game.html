<style>
  #game {
    border: 1px solid black;
    outline: none;
  }
  assets {
    display: none;
  }
</style>

<canvas id="game" width="720" height="680" tabindex="1"></canvas>

<assets>
  <img id="img-right-arrow" src="assets/right_arrow.png" />
</assets>

<script src="CanvasInput.min.js"></script>
<script src="Coordinate.js"></script>
<script src="Easing.js"></script>
<script src="Hexagon.js"></script>
<script src="HexagonAnimated.js"></script>
<script src="HexagonBackground.js"></script>
<script src="PriorityQueue.js"></script>
<script src="Events.js"></script>
<script src="Canvas.js"></script>
<script src="DrawTimer.js"></script>
<script src="Controller.js"></script>
<script src="InputDirection.js"></script>
<script src="InputHandler.js"></script>
<script src="KeyHandler.js"></script>
<script src="GestureHandler.js"></script>
<script src="ClickHandler.js"></script>
<script src="Board.js"></script>
<script src="Home.js"></script>
<script src="HighScore.js"></script>
<script src="Lost.js"></script>

<script>
  const ASSETS = {
    RIGHT_ARROW: document.getElementById('img-right-arrow')
  };
  const FPS = 60;

  const game = document.getElementById('game'); 
  const canvas = new Canvas('game');
  
  const inputHandler = new InputHandler(canvas);
  const keyHandler = new KeyHandler(canvas);
  const gestureHandler = new GestureHandler(canvas);
  const clickHandler = new ClickHandler(canvas);
  const drawTimer = new DrawTimer(canvas, FPS);
  
  const controller = new Controller(game, drawTimer, gestureHandler, clickHandler);
  
  drawTimer.start();
</script>

<br />Testing scores shit:<br />
<input id="name" placeholder="Name"></input>
<input id="score" placeholder="Score"></input>
<button id="addScore">Add Score</button><br />
Submitted Score: <score></score><br />
Your Rank: <rank></rank><br />
<br />
<button id="getScores">Get Highscore List</button><br />
<highscores></highscores>


<script>
  function callLambda(type, params = {}) {
    const LAMBDA_URL = 
        'https://7vm2om2s23.execute-api.us-east-1.amazonaws.com/prod/hex2048';
    
    const body = Object.assign({ type: type }, params);
    
    const request = {
    	method: 'post',
    	body: JSON.stringify(body)
    };
    
    return fetch(LAMBDA_URL, request).then((res) => {
      return res.json();
    });
  }
  
  document.querySelector('#addScore').addEventListener('click', function() {
    const name = document.querySelector('#name').value;
    const score = parseInt(document.querySelector('#score').value);
    
    callLambda('addScore', { name, score }).then((res) => {
      if (res.success) {
        document.querySelector('score').innerHTML = score;
        
        callLambda('getRank', { score }).then((res) => {
          if (res.success) {
            document.querySelector('rank').innerHTML = res.rank;
          }
        });
      }
    }).catch((err) => {
      alert(err.message);
    });
  });

  document.querySelector('#getScores').addEventListener('click', function() {
    const LIMIT = 10;
    
    callLambda('getScores', { limit: LIMIT }).then((res) => {
      if (res.success) {
        scores = ``;
        for (let entry of res.scores) {
          const { name, score } = entry;
          scores += `${name} - ${score}<br />`;
        }
        document.querySelector('highscores').innerHTML = scores;
      }
    }).catch((err) => {
      alert(err.message);
    });
  });
</script>